<html>
<head>
<!--
This style is adopted from the (now old) vagrant 1.0 web
pages. The style builds on the Twitter Bootstrap style.
Modifications by Hans Petter Langtangen, hpl@simula.no.

This style file should be copied and the following
elements edited:

Logo heading:

 LogoWord
 withSubWord

Navigation links at the top:

 GO TO 1
 GO TO 2

Footer at the end:

 Here goes a footer, if desired, maybe with a Copyright &copy;

-->

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Doconce: http://code.google.com/p/doconce/" />

<link rel="stylesheet" href="html_templates/css/twitter_bootstrap.css">
<link rel="stylesheet" href="html_templates/css/vagrant.css">
<!-- Define color of headings here (last definition counts) -->
<style type="text/css">
h1, h2, h3, h4, h5, h6 {
  color: #000;     /* black */
  color: #999;     /* gray */
  color: #005580;  /* dark blue */
  color: #08c;     /* characteristic blue */
</style>
</head>
<body>

<title> Exercise 3: Auto-generate code from function signature </title>

<!-- ------------------- main content ------------------------>

<div class="container">
 <div class="row Header with-border">
  <div class="span3 Module logo">
   <h1><a href="/">Flask<span class="subtitle">4scientists</span></a></h1>
  </div>
  <div class="span9">
   <div class="Module navigation">
   <!-- Navigation at the top of the page -->
    <ul>
     <li> <a href="http://flask.pocoo.org/">Flask</a></li>
    </ul>
   </div>
  </div>
 </div>
</div>


<!-- Here goes the table of contents in the sidebar
     <li class="active"> means dark blue background for current section
-->
<div class="row">
 <div class="span3 Module sidebar">
  <div class="well" style="padding: 8px 0px;">
   <ul class="nav nav-list">
     <!-- Syntax:
     <li> <a href="...">Section 1</a></li>
     <li> <a href="...">Section 2</a></li>
     <li> &nbsp;&nbsp;&nbsp; <a href="...">Section 2a</a></li>
     <li> &nbsp;&nbsp;&nbsp; <a href="...">Section 2b</a></li>
     -->
     <!-- Doconce automatically fills in the table of contents -->
          <!-- vagrant nav toc: " Web frameworks " --> <li>  <a href="._part0000_web4sa_flask.html#___sec0"> Web frameworks </a>
     <!-- vagrant nav toc: " The MVC pattern " --> <li> &nbsp;  <a href="._part0001_web4sa_flask.html#___sec1"> The MVC pattern </a>
     <!-- vagrant nav toc: " A very simple application " --> <li> &nbsp;  <a href="._part0002_web4sa_flask.html#___sec2"> A very simple application </a>
     <!-- vagrant nav toc: " Application of the MVC pattern " --> <li> &nbsp;  <a href="._part0003_web4sa_flask.html#wf:hw:mvc"> Application of the MVC pattern </a>
     <!-- vagrant nav toc: " Making a Flask application " --> <li>  <a href="._part0003_web4sa_flask.html#___sec4"> Making a Flask application </a>
     <!-- vagrant nav toc: " Programming the Flask application " --> <li> &nbsp;  <a href="._part0003_web4sa_flask.html#___sec5"> Programming the Flask application </a>
     <!-- vagrant nav toc: " Equipping the input page with output results " --> <li> &nbsp;  <a href="._part0004_web4sa_flask.html#___sec6"> Equipping the input page with output results </a>
     <!-- vagrant nav toc: " Splitting the app into model, view, and controller files " --> <li class="active"> &nbsp;  <a href="._part0005_web4sa_flask.html#wf:hw3:flask"> Splitting the app into model, view, and controller files </a>
     <!-- vagrant nav toc: " Troubleshooting " --> <li> &nbsp;  <a href="._part0005_web4sa_flask.html#___sec8"> Troubleshooting </a>
     <!-- vagrant nav toc: " Handling multiple input variables in Flask " --> <li>  <a href="._part0005_web4sa_flask.html#wf:vib:flask"> Handling multiple input variables in Flask </a>
     <!-- vagrant nav toc: " Programming the Flask application " --> <li> &nbsp;  <a href="._part0006_web4sa_flask.html#___sec10"> Programming the Flask application </a>
     <!-- vagrant nav toc: " Implementing error checking in the template " --> <li> &nbsp;  <a href="._part0007_web4sa_flask.html#___sec11"> Implementing error checking in the template </a>
     <!-- vagrant nav toc: " Using style sheets " --> <li> &nbsp;  <a href="._part0008_web4sa_flask.html#___sec12"> Using style sheets </a>
     <!-- vagrant nav toc: " Using LaTeX mathematics " --> <li> &nbsp;  <a href="._part0009_web4sa_flask.html#___sec13"> Using LaTeX mathematics </a>
     <!-- vagrant nav toc: " User-provided validation " --> <li> &nbsp;  <a href="._part0010_web4sa_flask.html#___sec14"> User-provided validation </a>
     <!-- vagrant nav toc: " Exercise 1: Add two numbers in a Flask app " --> <li> &nbsp;  <a href="._part0010_web4sa_flask.html#wf:exer:flask:add2"> Exercise 1: Add two numbers in a Flask app </a>
     <!-- vagrant nav toc: " Exercise 2: Add two numbers in a Django app " --> <li> &nbsp;  <a href="._part0010_web4sa_flask.html#wf:exer:django:add2"> Exercise 2: Add two numbers in a Django app </a>
     <!-- vagrant nav toc: " Exercise 3: Auto-generate code from function signature " --> <li> &nbsp;  <a href="._part0010_web4sa_flask.html#___sec17"> Exercise 3: Auto-generate code from function signature </a>

    </ul>
   </div>
  </div>

  <div class="span9">


<!-- tocinfo
{'highest level': 1,
 'sections': [(' Web frameworks ', 1, None, '___sec0'),
              (' The MVC pattern ', 2, None, '___sec1'),
              (' A very simple application ', 2, None, '___sec2'),
              (' Application of the MVC pattern ',
               2,
               'wf:hw:mvc',
               'wf:hw:mvc'),
              (' Making a Flask application ', 1, None, '___sec4'),
              (' Programming the Flask application ', 2, None, '___sec5'),
              (' Equipping the input page with output results ',
               2,
               None,
               '___sec6'),
              (' Splitting the app into model, view, and controller files ',
               2,
               'wf:hw3:flask',
               'wf:hw3:flask'),
              (' Troubleshooting ', 2, None, '___sec8'),
              (' Handling multiple input variables in Flask ',
               1,
               'wf:vib:flask',
               'wf:vib:flask'),
              (' Programming the Flask application ', 2, None, '___sec10'),
              (' Implementing error checking in the template ',
               2,
               None,
               '___sec11'),
              (' Using style sheets ', 2, None, '___sec12'),
              (' Using LaTeX mathematics ', 2, None, '___sec13'),
              (' User-provided validation ', 2, None, '___sec14'),
              (' Exercise 1: Add two numbers in a Flask app ',
               2,
               'wf:exer:flask:add2',
               'wf:exer:flask:add2'),
              (' Exercise 2: Add two numbers in a Django app ',
               2,
               'wf:exer:django:add2',
               'wf:exer:django:add2'),
              (' Exercise 3: Auto-generate code from function signature ',
               2,
               None,
               '___sec17')]}
end of tocinfo -->





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- Fix slow MathJax rendering in IE8 -->
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">




<a name="part0005"></a>
<!-- !split -->

<h3>Splitting the app into model, view, and controller files <a name="wf:hw3:flask"></a></h3>

<p>

In our previous to Flask apps we have had the model, view, and
controller parts in one file <code>controller.py</code>. For illustration we
may split the previous <code>controller.py</code> into three files:
<code>model.py</code>, <code>view.py</code>, and <code>controller.py</code>, located in a
directory <code>hw3_flask</code>. The contents
in these files reflects the splitting introduced in the original
scienticic hello world program in the section <a href="._part0003_web4sa_flask.html#wf:hw:mvc">Application of the MVC pattern</a>.
In the Flask context we have <code>model.py</code> as

<p>


<!-- code typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">wtforms</span> <span style="color: #008000; font-weight: bold">import</span> Form, FloatField, validators

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">InputForm</span>(Form):
    r <span style="color: #666666">=</span> FloatField(validators<span style="color: #666666">=</span>[validators<span style="color: #666666">.</span>InputRequired()])
</pre></div>
<p>

The view in 'view.py' consists of

<p>


<!-- code typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">flask</span> <span style="color: #008000; font-weight: bold">import</span> Flask, render_template, request
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">compute</span> <span style="color: #008000; font-weight: bold">import</span> compute

app <span style="color: #666666">=</span> Flask(__name__)

<span style="color: #AA22FF">@app.route</span>(<span style="color: #BA2121">&#39;/hw3&#39;</span>, methods<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;GET&#39;</span>, <span style="color: #BA2121">&#39;POST&#39;</span>])
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">index</span>():
    form <span style="color: #666666">=</span> InputForm(request<span style="color: #666666">.</span>form)
    <span style="color: #008000; font-weight: bold">if</span> request<span style="color: #666666">.</span>method <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;POST&#39;</span> <span style="color: #AA22FF; font-weight: bold">and</span> form<span style="color: #666666">.</span>validate():
        r <span style="color: #666666">=</span> form<span style="color: #666666">.</span>r<span style="color: #666666">.</span>data
        s <span style="color: #666666">=</span> compute(r)
    <span style="color: #008000; font-weight: bold">else</span>:
        s <span style="color: #666666">=</span> <span style="color: #008000">None</span>

    <span style="color: #008000; font-weight: bold">return</span> render_template(<span style="color: #BA2121">&quot;view.html&quot;</span>, form<span style="color: #666666">=</span>form, s<span style="color: #666666">=</span>s)
</pre></div>
<p>

The <code>controller.py</code> file finally runs the view's <code>app</code>:

<p>


<!-- code typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">view</span> <span style="color: #008000; font-weight: bold">import</span> app

<span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;__main__&#39;</span>:
    app<span style="color: #666666">.</span>run(debug<span style="color: #666666">=</span><span style="color: #008000">True</span>)
</pre></div>
<p>

The statements are indentical to those in the <code>hw2_flask</code> app, only
the organization of the statement in files differ.

<p>


<h3>Troubleshooting  <a name="___sec8"></a></h3>

<p>
<b>Address already in use.</b>
You can easily kill the Flask application and restart it, but sometimes
you will get an error that the address is already in use.
To recover from this problem, run the <code>lsof</code> program to see which program
that applies the 5000 port (Flask runs its server on <code>http://127.0.0.1:5000</code>):

<p>


<!-- code typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; lsof -i :5000
COMMAND   PID USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME
python  48824  hpl    3u  IPv4 1128848      0t0  TCP ...
Terminal&gt; <span style="color: #008000">kill</span> -9 48824
</pre></div>
<p>
The last command killed the <code>python</code> job that ran the test server and
you are ready to relaunch the Flask application.

<p>


<h2>Handling multiple input variables in Flask <a name="wf:vib:flask"></a></h2>

<p>
The scientific hello world example shows how to work with one input
variable and one output variable. We can easily derive a solution for
a collection of input variables and some corresponding HTML code
as result. Multiple input variables are listed in the <code>InputForm</code>
class using different types for different forms (text field,
float field, integer field, check box field for boolean values, etc.).
The value of these variables will be available in a <code>form</code> object
for computation. It is then a matter of taking the output from the
computation and format the corresponding HTML code for presenting
the result.

<p>
We address the task of plotting the function \( u(t)=Ae^{-bt}\sin (wt) \) for
\( t\in [0,T] \). The web application must have fields for the numbers \( A \),
\( b \), \( w \), and \( T \), and a <em>Compute</em> button, as shown in Figure
<a href="#wf:vib1:flask:fig:input">4</a>. Filling in values, say \( 0.1 \) for \( b \) and
\( 20 \) for \( T \), results in what we see in Figure <a href="#wf:vib1:flask:fig:result">5</a>,
i.e., a plot of \( u(t) \) is added after the input fields and the <em>Compute</em>
button.

<p>

<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 4:  The input page. <a name="wf:vib1:flask:fig:input"></a> </p></center>
<p><img src="fig-web4sa/vib1_flask_input.png" align="bottom" width=500></p>
</center>

<p>

<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 5:  The result page. <a name="wf:vib1:flask:fig:result"></a> </p></center>
<p><img src="fig-web4sa/vib1_flask_output.png" align="bottom" width=500></p>
</center>

<p>

<p>
<!-- ------------------- end of main content --------------- -->


<!--
Preliminary examples/discussion on vagrant style syntax

<div class='alert alert-block alert-notice'>
  <h3>What about PHP? Python? Java?</h3>
<p>
bla-bla.
</div>

<p>
While the <div class="deep-blue">rest of the</div> getting started
-->

<ul class="pager">
  <li class="previous">
    <a href="._part0004_web4sa_flask.html">&larr; Prev</a>
  </li>

  <li class="next">
    <a href="._part0006_web4sa_flask.html">Next &rarr;</a>
  </li>

</ul>

 </div>

<!-- ------------------- end of main content --------------- -->

 <div class="row Footer">
  <div class="span12">
  Copyright &copy 2013; Hans Petter Langtangen and Anders E. Johansen.
  Last update: .
  </div>
 </div>
</div>
</body>
</html>



