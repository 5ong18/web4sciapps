

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Exercises &mdash; Using Web Frameworks for Scientific Applications</title>
    
    <link rel="stylesheet" href="_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="_static/cloud.js"></script>

        <script src="http://sagecell.sagemath.org/static/jquery.min.js"></script>
        <script src="http://sagecell.sagemath.org/static/embedded_sagecell.js"></script>

        <script>sagecell.makeSagecell({inputLocation: ".sage"});</script>

        <style type="text/css">
                .sagecell .CodeMirror-scroll {
                        overflow-y: hidden;
                        overflow-x: auto;
                }
                .sagecell .CodeMirror {
                        height: auto;
                }
        </style>

    
    <link rel="top" title="Using Web Frameworks for Scientific Applications" href="index.html" />
    <link rel="next" title="Resources (3)" href="._web4sa007.html" />
    <link rel="prev" title="Handling multiple input variables in Django" href="._web4sa005.html" />
 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body role="document">
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="._web4sa007.html" title="Resources (3)"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="._web4sa005.html" title="Handling multiple input variables in Django"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">Using Web Frameworks for Scientific Applications</a> &raquo;</li>
 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="exercises">
<h1>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h1>
<div class="section" id="exercise-1-add-two-numbers">
<span id="wf-exer-add2"></span><h2>Exercise 1: Add two numbers<a class="headerlink" href="#exercise-1-add-two-numbers" title="Permalink to this headline">¶</a></h2>
<p>Make a web application that reads two numbers from a web page,
adds the numbers, and prints the sum in a new web page.
Package the necessary files that constitute the application
in a tar file.
Filename: <code class="docutils literal"><span class="pre">add2.tar.gz</span></code>.</p>
</div>
<div class="section" id="exercise-2-upload-data-file-and-visualize-curves">
<span id="wf-exer-upload"></span><h2>Exercise 2: Upload data file and visualize curves<a class="headerlink" href="#exercise-2-upload-data-file-and-visualize-curves" title="Permalink to this headline">¶</a></h2>
<p>Suppose you have tabular data in a file:</p>
<div class="highlight-text"><div class="highlight"><pre>#  t        y       error
0.0000    1.2345   1.4E-4
1.0000    0.9871  -4.9E-3
1.2300    0.5545   8.2E-3
</pre></div>
</div>
<p>That is, there is a comment line with headings for the various
columns, and then floating-point values are listed with an
arbitrary number of columns and rows. You want to upload such
a data file to a web application and have the each column, from
the second one, plotted against the the values in the first column.
In the particular example, <code class="docutils literal"><span class="pre">y</span></code> and <code class="docutils literal"><span class="pre">error</span></code> should be plotted against
<code class="docutils literal"><span class="pre">t</span></code>, yielding two curves.</p>
<p>The web application may have one field: the name of the file to upload.
Search for constructions on how to upload a files and write this
application. Generate a suitable data file for testing purposes.
Filename: <code class="docutils literal"><span class="pre">upload.tar.gz</span></code>.</p>
</div>
<div class="section" id="exercise-3-plot-a-user-specified-formula">
<span id="wf-exer-formula"></span><h2>Exercise 3: Plot a user-specified formula<a class="headerlink" href="#exercise-3-plot-a-user-specified-formula" title="Permalink to this headline">¶</a></h2>
<p>The purpose of this exercise is to write a web application that
can visualize any user-given formula. For example, in the interface below,</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/plot_formula.png"><img alt="_images/plot_formula.png" src="_images/plot_formula.png" style="width: 600px;" /></a>
</div>
<p>the user has</p>
<blockquote>
<div><ul class="simple">
<li>specified a curve <span class="math">\(\sin (x)\)</span> (<code class="docutils literal"><span class="pre">sin(x)</span></code>) to be plotted</li>
<li>specified the <span class="math">\(x\)</span> interval to be <span class="math">\([0,2\pi]\)</span> (<code class="docutils literal"><span class="pre">[0,</span> <span class="pre">2*pi]</span></code>)</li>
<li>clicked <em>Compute</em> to get a blue line with the sine curve</li>
<li>specified a new formula <span class="math">\(\sin(x)e^{-x}\)</span> (<code class="docutils literal"><span class="pre">sin(x)*exp(-x)</span></code>)</li>
<li>chosen <em>No</em> as the answer to <em>Erase all curves?</em></li>
<li>clicked <em>Compute</em> to have the  <span class="math">\(\sin(x)e^{-x}\)</span> drawn
with green line without erasing the previous curve</li>
</ul>
</div></blockquote>
<p>That is, the user can fill in any expression in <span class="math">\(x\)</span>, specify the
domain for plotting, and choose whether new curves should be added
to the plot or if all curves should be erased prior to drawing a
new one.</p>
<p><strong>Hint 1.</strong>
You may use the <code class="docutils literal"><span class="pre">vib1</span></code> app from the section <a class="reference internal" href="._web4sa004.html#wf-vib1-flask-app"><span class="std std-ref">Programming the Flask application  (2)</span></a>
with the <code class="docutils literal"><span class="pre">view_errcheck.html</span></code> template as starting point.
Preferably, let plots be created as strings, as explained for the <code class="docutils literal"><span class="pre">vib2</span></code>
app in the section <a class="reference internal" href="._web4sa004.html#wf-vib2-flask-nofiles"><span class="std std-ref">Avoiding plot files</span></a>.</p>
<p>The <em>Formula</em> and <em>Domain</em> fields need to be <code class="docutils literal"><span class="pre">TextField</span></code> objects,
and the compute function must perform an <code class="docutils literal"><span class="pre">eval</span></code> on the user&#8217;s input.
The <em>Erase</em> field is a <code class="docutils literal"><span class="pre">SelectField</span></code> object with selections <em>Yes</em> and
<em>No</em>. The former means that the compute function calls the <code class="docutils literal"><span class="pre">figure</span></code>
function in Matplotlib before creating a new plot. If this is not
done, a new formula will be plotting in the same figure as the last one.
With the Yes/No selection, it is possible either plot individual curves
or compare curves in the same plot.</p>
<p><strong>Hint 2.</strong>
Performing <code class="docutils literal"><span class="pre">eval</span></code> on the user&#8217;s input requires that names like
<code class="docutils literal"><span class="pre">sin</span></code>, <code class="docutils literal"><span class="pre">exp</span></code>, and <code class="docutils literal"><span class="pre">pi</span></code> are defined. The simplest approach is to
do a</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>in the top of the file containing the compute function. All the names
from <code class="docutils literal"><span class="pre">numpy</span></code> are then available as global variables and one can simply
do <code class="docutils literal"><span class="pre">domain</span> <span class="pre">=</span> <span class="pre">eval(domain)</span></code> to turn the string <code class="docutils literal"><span class="pre">domain</span></code> coming from
the <em>Domain</em> text field into a Python list with two elements.</p>
<p>A better approach is not to rely on global variables, but run <code class="docutils literal"><span class="pre">eval</span></code>
in the <code class="docutils literal"><span class="pre">numpy</span></code> namespace:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="n">domain</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
</pre></div>
</div>
<p>The evaluation of the formula is slightly more complicated if <code class="docutils literal"><span class="pre">eval</span></code>
is to be run with the <code class="docutils literal"><span class="pre">numpy</span></code> namespace. One first needs
to create <span class="math">\(x\)</span> coordinates:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">domain</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10001</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, <code class="docutils literal"><span class="pre">eval(formula,</span> <span class="pre">numpy.__dict__)</span></code> will not work because a formula
like <code class="docutils literal"><span class="pre">sin(x)</span></code> needs both <code class="docutils literal"><span class="pre">sin</span></code> and <code class="docutils literal"><span class="pre">x</span></code> in the namespace. The latter
is not in the namespace and must be explicitly included. A new namespace
can be made:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">namespace</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">namespace</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">})</span>
<span class="n">formula</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Hint 3.</strong>
You should add tests when evaluating and using the strings from input
as these may have wrong syntax.</p>
<p>Filename: <code class="docutils literal"><span class="pre">plot_formula.tar.gz</span></code>.</p>
</div>
<div class="section" id="exercise-4-visualize-taylor-polynomial-approximations">
<span id="wf-exer-taylor"></span><h2>Exercise 4: Visualize Taylor polynomial approximations<a class="headerlink" href="#exercise-4-visualize-taylor-polynomial-approximations" title="Permalink to this headline">¶</a></h2>
<p>This exercise develops a web application that can plot Taylor polynomial
approximations of <em>any</em> degree
to <em>any</em> user-given formula. You should do
<a class="reference internal" href="#wf-exer-formula"><span class="std std-ref">Exercise 3: Plot a user-specified formula</span></a> first as many of the techniques there
must be used and even further developed in the present exercise.</p>
<p>The figure below shows an example of what one can do in the
web app:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Taylor_approx.png"><img alt="_images/Taylor_approx.png" src="_images/Taylor_approx.png" style="width: 600px;" /></a>
</div>
<p>Here, the user has</p>
<blockquote>
<div><ul class="simple">
<li>filled in the formula <span class="math">\(\sin(x)\)</span> (<code class="docutils literal"><span class="pre">sin(x)</span></code>)</li>
<li>specified <em>N</em> to be 3</li>
<li>clicked <em>Compute</em> to get the formula <span class="math">\(\sin(x)\)</span> plotted together with
the Taylor polynomial approximation of degree 3, expanded around <span class="math">\(x=0\)</span></li>
<li>changed <em>N</em> to 5</li>
<li>chosen <em>No</em> for the question <em>Erase all curves?</em></li>
<li>clicked <em>Compute</em> to have the series expansion of degree 5 plotted
in the same plot</li>
<li>changed <em>N</em> to 10</li>
<li>clicked <em>Compute</em> to have the series expansion of degree 10 plotted
in the same plot</li>
</ul>
</div></blockquote>
<p>We can use <code class="docutils literal"><span class="pre">sympy</span></code> to produce Taylor polynomial expansions of arbitrary
expressions. Here is a session demonstrating how to obtain the
series expansion of <span class="math">\(e^{-x}\sin (\pi x)\)</span> to 2nd degree.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sympy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">sp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">pi*x - pi*x**2 + O(x**3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sp</span><span class="o">.</span><span class="n">latex</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">&#39;\\pi x - \\pi x^{2} + \\mathcal{O}\\left(x^{3}\\right)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">removeO</span><span class="p">()</span>  <span class="c"># get rid of O() term</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fs</span>
<span class="go">-pi*x**2 + pi*x</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f_func</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">lambdify</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">fs</span><span class="p">)</span>     <span class="c"># make Python function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f_func</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f_func</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">-6.283185307179586</span>
</pre></div>
</div>
<p>Basically, the steps above must be carried out to create a Python
function for the series expansion such that it can be plotted.
A similar <code class="docutils literal"><span class="pre">sp.lambdify</span></code> call on the original formula is also necessary
to plot that one.</p>
<p>However, the challenge is that the formula is
available only as a string, and it may contain an independent variable
whose name is also only available through a string from the web interface.
That is, we may give formulas like <code class="docutils literal"><span class="pre">exp(-t)</span></code> if <code class="docutils literal"><span class="pre">t</span></code> is chosen as
independent variable.
Also, the expression does not contain function names prefixed with <code class="docutils literal"><span class="pre">sympy</span></code> or
<code class="docutils literal"><span class="pre">sp</span></code>, just plain names like <code class="docutils literal"><span class="pre">sin</span></code>, <code class="docutils literal"><span class="pre">cos</span></code>, <code class="docutils literal"><span class="pre">exp</span></code>, etc.
An example on <code class="docutils literal"><span class="pre">formula</span></code> is <code class="docutils literal"><span class="pre">cos(pi*x)</span> <span class="pre">+</span> <span class="pre">log(x)</span></code>.</p>
<p><strong>a)</strong>
Write a function</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">formula2series2pyfunc</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</pre></div>
</div>
<p>that takes a <code class="docutils literal"><span class="pre">sympy</span></code> formula, and integer <code class="docutils literal"><span class="pre">N</span></code>, a <code class="docutils literal"><span class="pre">sympy</span></code> symbol <code class="docutils literal"><span class="pre">x</span></code>
and another <code class="docutils literal"><span class="pre">sympy</span></code> symbol <code class="docutils literal"><span class="pre">x0</span></code> and returns
1) a Python function for <code class="docutils literal"><span class="pre">formula</span></code>, 2) a Python function for the
series expansion of degree <code class="docutils literal"><span class="pre">N</span></code> of the formula around <code class="docutils literal"><span class="pre">x0</span></code>, and
3) a LaTeX string containing the formula for the series expansion.</p>
<p>Put the function in a file <code class="docutils literal"><span class="pre">compute.py</span></code>. You should thereafter be able to run
the following session:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">compute</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sympy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formula</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">latex</span> <span class="o">=</span> <span class="n">compute</span><span class="o">.</span><span class="n">formula2series2pyfunc</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">latex</span>
<span class="go">&#39;- \\frac{4 t^{3}}{3} + 2 t^{2} - 2 t + 1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="go">[&lt;matplotlib.lines.Line2D at 0x7fc6c020f350&gt;,</span>
<span class="go"> &lt;matplotlib.lines.Line2D at 0x7fc6c020f5d0&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The resulting plot is displayed below.</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/Taylor_approx_exp2t.png"><img alt="_images/Taylor_approx_exp2t.png" src="_images/Taylor_approx_exp2t.png" style="width: 500px;" /></a>
</div>
<p><strong>Hint.</strong>
The series expansion is obtained by <code class="docutils literal"><span class="pre">formula.series(x,</span> <span class="pre">x0,</span> <span class="pre">N)</span></code>,
but the output contains an <code class="docutils literal"><span class="pre">O()</span></code> term which makes it impossible to
convert the expression to a Python function via <code class="docutils literal"><span class="pre">sympy.lambify</span></code>.
Use</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">series</span> <span class="o">=</span> <span class="n">formula</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">removeO</span><span class="p">()</span>
</pre></div>
</div>
<p>to get an expression that can be used as argument to <code class="docutils literal"><span class="pre">sympy.lambdify</span></code>.
We use <code class="docutils literal"><span class="pre">N+1</span></code> since <code class="docutils literal"><span class="pre">N</span></code> in the <code class="docutils literal"><span class="pre">series</span></code> function refers to the degree
of the <code class="docutils literal"><span class="pre">O()</span></code> term, which is now removed.</p>
<p>For the LaTeX expression it is natural to have the <code class="docutils literal"><span class="pre">O()</span></code> term:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">latex</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">latex</span><span class="p">(</span><span class="n">formula</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>because then the terms start with the lowest order (and not the highest
order as is the case when <code class="docutils literal"><span class="pre">removeO()</span></code> is used).</p>
<p><strong>b)</strong>
Write the compute function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">visualize_series</span><span class="p">(</span>
    <span class="n">formula</span><span class="p">,</span>                  <span class="c"># string: formula</span>
    <span class="n">independent_variable</span><span class="p">,</span>     <span class="c"># string: name of independent var.</span>
    <span class="n">N</span><span class="p">,</span>                        <span class="c"># int: degree of polynomial approx.</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span>   <span class="c"># strings: extent of axes</span>
    <span class="n">legend_loc</span><span class="p">,</span>               <span class="c"># string: upper left, etc.</span>
    <span class="n">x0</span><span class="o">=</span><span class="s">&#39;0&#39;</span><span class="p">,</span>                   <span class="c"># string: point of expansion</span>
    <span class="n">erase</span><span class="o">=</span><span class="s">&#39;yes&#39;</span><span class="p">,</span>              <span class="c"># string: &#39;yes&#39; or &#39;no&#39;</span>
    <span class="p">):</span>
</pre></div>
</div>
<p><strong>Hint 1.</strong>
Converting the string <code class="docutils literal"><span class="pre">formula</span></code> to a valid <code class="docutils literal"><span class="pre">sympy</span></code> expression is
challenging. First, create a local variable for a <code class="docutils literal"><span class="pre">sympy</span></code> symbol
with the content of
<code class="docutils literal"><span class="pre">independent_variable</span></code> as name, since such a variable is needed
with performing <code class="docutils literal"><span class="pre">eval</span></code> on <code class="docutils literal"><span class="pre">formula</span></code>. Also introduce a variable <code class="docutils literal"><span class="pre">x</span></code>
to point to the same <code class="docutils literal"><span class="pre">sympy</span></code> symbol. Relevant code is</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Turn independent variable into sympy symbol, stored in x</span>
<span class="kn">import</span> <span class="nn">sympy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="k">exec</span><span class="p">(</span><span class="s">&#39;x = </span><span class="si">%s</span><span class="s"> = sp.symbols(&quot;</span><span class="si">%s</span><span class="s">&quot;)&#39;</span> <span class="o">%</span>
     <span class="p">(</span><span class="n">independent_variable</span><span class="p">,</span> <span class="n">independent_variable</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Hint 2.</strong>
Evaluating <code class="docutils literal"><span class="pre">formula</span></code> in the namespace of <code class="docutils literal"><span class="pre">sympy</span></code> (so that all the <code class="docutils literal"><span class="pre">sin</span></code>,
<code class="docutils literal"><span class="pre">exp</span></code>, <code class="docutils literal"><span class="pre">pi</span></code>, and similar symbols are defined properly as <code class="docutils literal"><span class="pre">sympy</span></code>
objects) needs a merge of the <code class="docutils literal"><span class="pre">sympy</span></code> namespace and the variable for
the <code class="docutils literal"><span class="pre">sympy</span></code> symbol representing the independent variable:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">namespace</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">local</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">local</span><span class="p">[</span><span class="n">independent_variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">namespace</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">local</span><span class="p">)</span>
<span class="n">formula</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</pre></div>
</div>
<p>Turning <code class="docutils literal"><span class="pre">x0</span></code> into a valid <code class="docutils literal"><span class="pre">sympy</span></code> expression is easier: <code class="docutils literal"><span class="pre">x0</span> <span class="pre">=</span> <span class="pre">eval(x0,</span> <span class="pre">sp.__dict__)</span></code>.</p>
<p><strong>Hint 3.</strong>
Note that in the web interface, the minimum and maximum values on the axis
can be mathematical expressions such as <code class="docutils literal"><span class="pre">2*pi</span></code>. This means that these
quantities must be strings that are evaluated in the <code class="docutils literal"><span class="pre">numpy</span></code> namespace, e.g.,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Hint 4.</strong>
Getting the legends right when plotting multiple curves in the same
plot is a bit tricky. One solution is to have a global variable <code class="docutils literal"><span class="pre">legends</span></code>
that is initialized to <code class="docutils literal"><span class="pre">[]</span></code> and do the following inside the compute function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="k">global</span> <span class="n">legends</span>
<span class="k">if</span> <span class="n">erase</span> <span class="o">==</span> <span class="s">&#39;yes&#39;</span><span class="p">:</span>   <span class="c"># Start new figure?</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">legends</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">legends</span><span class="p">:</span>
    <span class="c"># We come here every time the figure is empty so</span>
    <span class="c"># we need to draw the formula</span>
    <span class="n">legends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$</span><span class="si">%s</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="n">sp</span><span class="o">.</span><span class="n">latex</span><span class="p">(</span><span class="n">formula</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal"><span class="pre">f</span></code> is the Python function for computing the <code class="docutils literal"><span class="pre">numpy</span></code> variant
of the expression in <code class="docutils literal"><span class="pre">formula</span></code>.</p>
<p><strong>Hint 5.</strong>
Use the test block in the file to call the compute function several
times with different values of the <code class="docutils literal"><span class="pre">erase</span></code> parameter to test that
the erase functionality is correct.</p>
<p><strong>c)</strong>
Write the remaining files. These have straightforward content if
<a class="reference internal" href="#wf-exer-formula"><span class="std std-ref">Exercise 3: Plot a user-specified formula</span></a> is done and understood.</p>
<p>Filename: <code class="docutils literal"><span class="pre">Taylor_approx.tar.gz</span></code>.</p>
</div>
<div class="section" id="exercise-5-extend-the-gen-app">
<span id="wf-exer-gen-demo"></span><h2>Exercise 5: Extend the <code class="docutils literal"><span class="pre">gen</span></code> app<a class="headerlink" href="#exercise-5-extend-the-gen-app" title="Permalink to this headline">¶</a></h2>
<p>Add a new argument <code class="docutils literal"><span class="pre">x_axis</span></code> to the <code class="docutils literal"><span class="pre">compute</span></code> function in the
<a class="reference external" href="https://github.com/hplgit/web4sciapps/tree/master/doc/src/web4sa/src-web4sa/apps/flask_apps/gen">gen</a>
application from the section <a class="reference internal" href="._web4sa004.html#wf-autogen-flask"><span class="std std-ref">Autogenerating the code</span></a>. The <code class="docutils literal"><span class="pre">x_axis</span></code> argument measures the extent
of the <span class="math">\(x\)</span> axis in the plots in terms of the number of standard
deviations (default may be 7).  Observe how the web interface
automatically adds the new argument and how the plots adapt!</p>
</div>
<div class="section" id="exercise-6-equip-the-gen-app-with-more-data-types">
<span id="wf-exer-gen-lists"></span><h2>Exercise 6: Equip the <code class="docutils literal"><span class="pre">gen</span></code> app with more data types<a class="headerlink" href="#exercise-6-equip-the-gen-app-with-more-data-types" title="Permalink to this headline">¶</a></h2>
<p>In the <a class="reference external" href="https://github.com/hplgit/web4sciapps/tree/master/doc/src/web4sa/src-web4sa/apps/flask_apps/gen">gen</a>
application from the section <a class="reference internal" href="._web4sa004.html#wf-autogen-flask"><span class="std std-ref">Autogenerating the code</span></a>,
use the <code class="docutils literal"><span class="pre">label</span></code> argument in the form field objects to add an
information of the type of data that is to be supplied in the
text field. Extend the <code class="docutils literal"><span class="pre">model.py</span></code> file to also handle
lists, tuples, and Numerical Python arrays. For these three
new data types, use a <code class="docutils literal"><span class="pre">TextField</span></code> object and run <code class="docutils literal"><span class="pre">eval</span></code>
on the text in the <code class="docutils literal"><span class="pre">view.py</span></code> file.
A simple test is to extend the <code class="docutils literal"><span class="pre">compute</span></code> function with an
argument <code class="docutils literal"><span class="pre">x_range</span></code> for the range of the <span class="math">\(x\)</span> axis, specified as
an interval (2-list or 2-tuple).
Filename: <code class="docutils literal"><span class="pre">gen_ext.tar.gz</span></code>.</p>
</div>
<div class="section" id="exercise-7-auto-generate-code-from-function-signature">
<h2>Exercise 7: Auto-generate code from function signature<a class="headerlink" href="#exercise-7-auto-generate-code-from-function-signature" title="Permalink to this headline">¶</a></h2>
<p>Given a <code class="docutils literal"><span class="pre">compute</span></code> with a set of positional and keyword
arguments, the purpose of this exercise is to <em>automatically</em> generate the
Flask files <code class="docutils literal"><span class="pre">model.py</span></code> and <code class="docutils literal"><span class="pre">controller.py</span></code>. Use the Python <code class="docutils literal"><span class="pre">inspect</span></code>
module, see the section <a class="reference internal" href="._web4sa004.html#wf-autogen-flask"><span class="std std-ref">Autogenerating the code</span></a>, to extract
the positional and keyword arguments in <code class="docutils literal"><span class="pre">compute</span></code>, and use this
information to construct the relevant Python code in strings. Write
the strings to <code class="docutils literal"><span class="pre">model.py</span></code> and <code class="docutils literal"><span class="pre">controller.py</span></code> files. Assume as
in the section <a class="reference internal" href="._web4sa004.html#wf-autogen-flask"><span class="std std-ref">Autogenerating the code</span></a> that the user provides
a file <code class="docutils literal"><span class="pre">view_results.html</span></code> for defining how the returned object
from the <code class="docutils literal"><span class="pre">compute</span></code> function is to be rendered.</p>
<p>Test the code generator on the <code class="docutils literal"><span class="pre">compute</span></code> function in the <code class="docutils literal"><span class="pre">vib1</span></code>
application to check that the generated
<code class="docutils literal"><span class="pre">model.py</span></code> and <code class="docutils literal"><span class="pre">controller.py</span></code> files are correct.
Filename: <code class="docutils literal"><span class="pre">generate_flask.py</span></code>.</p>
</div>
<div class="section" id="project-8-interactive-function-exploration">
<span id="wf-exer-bokeh-ui"></span><h2>Project 8: Interactive function exploration<a class="headerlink" href="#project-8-interactive-function-exploration" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://bokeh.pydata.org/en/latest/">Bokeh</a> Python library works
very well with Flask. The purpose of this exercise is to make a web app
where one can explore how parameters in a function influence
the function&#8217;s shape. Given some function <span class="math">\(f(x;p_0,p_1,\ldots,p_n)\)</span>,
where <span class="math">\(x\)</span> is the independent variable and <span class="math">\(p_0,p_1,\ldots,p_n\)</span> are
parameters, we want to create a user interface with a plot field
and text fields or
sliders for <span class="math">\(p_0,p_1,\ldots,p_n\)</span> such that altering any parameter
immediately updates the graph of the <span class="math">\(f\)</span> as a function of <span class="math">\(x\)</span>.
The Bokeh web side contains a <a class="reference external" href="http://bokeh.pydata.org/en/latest/docs/server_gallery/sliders_server.html">demo</a>: for the specific function</p>
<div class="math">
\[f(x;x_0,A,\phi,\omega)= x_0 + A\sin(\omega (x + \phi)).\]</div>
<p>However, this project is about accepting any function
<span class="math">\(f(x;p_0,p_1,\ldots,p_n)\)</span> and creating tailored Flask/Bokeh code of the type
in the demo. The user must specify a Python function for <span class="math">\(f\)</span>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="n">x_0</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">x_0</span> <span class="o">+</span> <span class="n">A</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">omega</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">phi</span><span class="p">))</span>
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">p</span></code> is a list of parameter values. In addition, the user must
provide info about each parameter: the name, a range or a number,
and if range, a default value. Here is an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">p_info</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s">&#39;offset&#39;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;amplitude&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="mf">2.5</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;phase&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;frequency&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
<p>Parameters with an interval range get a slider for setting the value,
while parameters with only a number, as for <code class="docutils literal"><span class="pre">phase</span></code> in this example,
get a text field where the user can alter the number.</p>
<p>The user must also provide a suitable range for the <span class="math">\(x\)</span> axis.
As test case beyond the example above, try a Gaussian function
with this input from the user:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">p</span>
    <span class="k">return</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span>\
           <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">p_info</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s">&#39;mean&#39;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;standard deviation&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="mi">1</span><span class="p">)]</span>

<span class="n">x_axis</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
<p>Filename: <code class="docutils literal"><span class="pre">expore_func.tar.gz</span></code>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinxlocaltoc">
    <h3><a href="index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Exercises</a><ul>
<li><a class="reference internal" href="#exercise-1-add-two-numbers">Exercise 1: Add two numbers</a></li>
<li><a class="reference internal" href="#exercise-2-upload-data-file-and-visualize-curves">Exercise 2: Upload data file and visualize curves</a></li>
<li><a class="reference internal" href="#exercise-3-plot-a-user-specified-formula">Exercise 3: Plot a user-specified formula</a></li>
<li><a class="reference internal" href="#exercise-4-visualize-taylor-polynomial-approximations">Exercise 4: Visualize Taylor polynomial approximations</a></li>
<li><a class="reference internal" href="#exercise-5-extend-the-gen-app">Exercise 5: Extend the <code class="docutils literal"><span class="pre">gen</span></code> app</a></li>
<li><a class="reference internal" href="#exercise-6-equip-the-gen-app-with-more-data-types">Exercise 6: Equip the <code class="docutils literal"><span class="pre">gen</span></code> app with more data types</a></li>
<li><a class="reference internal" href="#exercise-7-auto-generate-code-from-function-signature">Exercise 7: Auto-generate code from function signature</a></li>
<li><a class="reference internal" href="#project-8-interactive-function-exploration">Project 8: Interactive function exploration</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="._web4sa005.html"
                          title="Previous page">&larr; Handling multiple input variables in Django</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="._web4sa007.html"
                          title="Next page">&rarr; Resources  (3)</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/._web4sa006.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="._web4sa007.html" title="Resources (3)"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="._web4sa005.html" title="Handling multiple input variables in Django"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">Using Web Frameworks for Scientific Applications</a> &raquo;</li>
 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright H. P. Langtangen and A. E. Johansen.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4a0+.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>