

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Making a Django application &mdash; Using Web Frameworks for Scientific Applications</title>
    
    <link rel="stylesheet" href="_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="_static/cloud.js"></script>

        <script src="http://sagecell.sagemath.org/static/jquery.min.js"></script>
        <script src="http://sagecell.sagemath.org/static/embedded_sagecell.js"></script>

        <script>sagecell.makeSagecell({inputLocation: ".sage"});</script>

        <style type="text/css">
                .sagecell .CodeMirror-scroll {
                        overflow-y: hidden;
                        overflow-x: auto;
                }
                .sagecell .CodeMirror {
                        height: auto;
                }
        </style>

    
    <link rel="top" title="Using Web Frameworks for Scientific Applications" href="index.html" />
    <link rel="next" title="Handling multiple input variables in Flask" href="._web4sa004.html" />
    <link rel="prev" title="Making a Flask application" href="._web4sa002.html" />
 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body role="document">
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="._web4sa004.html" title="Handling multiple input variables in Flask"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="._web4sa002.html" title="Making a Flask application"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">Using Web Frameworks for Scientific Applications</a> &raquo;</li>
 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="making-a-django-application">
<h1>Making a Django application<a class="headerlink" href="#making-a-django-application" title="Permalink to this headline">¶</a></h1>
<p id="index-0">We recommend to
download and istall the latest official version of Django from
<a class="reference external" href="http://www.djangoproject.com/download/">http://www.djangoproject.com/download/</a>. Pack out the tarfile, go
to the directory, and run <code class="docutils literal"><span class="pre">setup.py</span></code>:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; tar xvzf Django-1.5-tar.gz
Terminal&gt; cd Django-1.5
Terminal&gt; sudo python setup.py install
</pre></div>
</div>
<p>The version in this example, 1.5, may be different at the time you
follow these instructions.</p>
<div class="section" id="setting-up-a-django-project">
<h2>Setting up a Django project<a class="headerlink" href="#setting-up-a-django-project" title="Permalink to this headline">¶</a></h2>
<p id="index-1">Django applies two concepts: <em>project</em> and <em>application</em> (or <em>app</em>).
The app is the program we want to run through a web interface. The
project is a Python package containing common settings and
configurations for a collection of apps. This means that before we can
make a Django app, we must to establish a Django project.</p>
<p>A Django project for managing a set of Django apps is
created by the command</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; django-admin.py startproject django_project
</pre></div>
</div>
<p>The result in this example
is a directory <code class="docutils literal"><span class="pre">django_project</span></code> whose content can be explored
by some <code class="docutils literal"><span class="pre">ls</span></code> and <code class="docutils literal"><span class="pre">cd</span></code> commands:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; ls django_project
manage.py django_project
Terminal&gt; cd django_project/django_project
Terminal&gt; ls
__init__.py settings.py urls.py wsgi.py
</pre></div>
</div>
<p>The meaning of the generated files is briefly listed below.</p>
<blockquote>
<div><ul class="simple">
<li>The outer <code class="docutils literal"><span class="pre">django_project/</span></code> directory is just a container for your project. Its name does not matter to Django.</li>
<li><code class="docutils literal"><span class="pre">manage.py</span></code> is a command-line utility that lets you interact with this Django project in various ways. You will typically run <code class="docutils literal"><span class="pre">manage.py</span></code> to launch a Django application.</li>
<li>The inner <code class="docutils literal"><span class="pre">django_project/</span></code> directory is a Python package for the Django project. Its name is used in import statements in Python code (e.g., <code class="docutils literal"><span class="pre">import</span> <span class="pre">django_project.settings</span></code>).</li>
<li><code class="docutils literal"><span class="pre">django_project/__init__.py</span></code> is an empty file that just tells Python that this directory should be considered a Python package.</li>
<li><code class="docutils literal"><span class="pre">django_project/settings.py</span></code> contains the settings and configurations for this Django project.</li>
<li><code class="docutils literal"><span class="pre">django_project/urls.py</span></code> maps URLs to specific functions and thereby defines that actions that various URLs imply.</li>
<li><code class="docutils literal"><span class="pre">django_project/wsgi.py</span></code> is not needed in our examples.</li>
</ul>
</div></blockquote>
<p>Django comes with a web server for developing and debugging applications.
The server is started by running</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python manage.py runserver
Validating models...

0 errors found
March 34, 201x - 01:09:24
Django version 1.5, using settings &#39;django_project.settings&#39;
Development server is running at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
</pre></div>
</div>
<p>The output from starting the server tells that the server runs on the
URL <code class="docutils literal"><span class="pre">http://127.0.0.1:8000/</span></code>.
Load this URL into your browser to see a welcome message from Django,
meaning that the server is working.</p>
<p>Despite the fact that our introductory
web applications do not need a database, you
have to register a database with any Django project. To this end,
open the <code class="docutils literal"><span class="pre">django_project/settings.py</span></code> file in a text editor,
locate the <code class="docutils literal"><span class="pre">DATABASES</span></code> dictionary and type in the following
code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">relative2absolute_path</span><span class="p">(</span><span class="n">relative_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the absolute path correspodning to relative_path.&quot;&quot;&quot;</span>
    <span class="n">dir_of_this_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">dir_of_this_file</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">relative_path</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s">&#39;default&#39;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
      <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">relative2absolute_path</span><span class="p">(</span><span class="s">&#39;../database.db&#39;</span><span class="p">)</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">settings.py</span></code> file needs absolute paths to files, while it is
more convenient for us to specify relative paths. Therefore,
we made a function that figures out the absolute path to the <code class="docutils literal"><span class="pre">settings.py</span></code>
file and then combines this absolute path with the relative path.
The location and name of the database file can be chosen as desired.
Note that one should <em>not</em> use <code class="docutils literal"><span class="pre">os.path.join</span></code> to create paths as Django
always applies the forward slash between directories, also on Windows.</p>
</div>
<div class="section" id="setting-up-a-django-application">
<h2>Setting up a Django application<a class="headerlink" href="#setting-up-a-django-application" title="Permalink to this headline">¶</a></h2>
<p id="index-2">The next step is to create a Django app for our scientific hello
world program. We can place the app in any directory, but here we
utilize the following organization.
As neighbor to <code class="docutils literal"><span class="pre">django_project</span></code> we have
a directory <code class="docutils literal"><span class="pre">apps</span></code> containing our various scientific applications.
Under <code class="docutils literal"><span class="pre">apps</span></code> we create a directory <code class="docutils literal"><span class="pre">django_apps</span></code> with
our different versions of Django applications.
The directory <code class="docutils literal"><span class="pre">py_apps</span></code> contains the
original <code class="docutils literal"><span class="pre">hw.py</span></code> program in the subdirectory <code class="docutils literal"><span class="pre">orig</span></code>,
while split of this
program according to the MVC pattern appears in the <code class="docutils literal"><span class="pre">mvc</span></code> directory.</p>
<p>The directory <code class="docutils literal"><span class="pre">django_apps/hw1</span></code> is our first attempt to write
a Django-based web interface for the <code class="docutils literal"><span class="pre">hw.py</span></code> program.
The directory structure is laid out by</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; cd ..
Terminal&gt; mkdir apps
Terminal&gt; cd apps
Terminal&gt; mkdir py_apps
Terminal&gt; cd py
Terminal&gt; mkdir orig mvc
Terminal&gt; cd ../..
Terminal&gt; mkdir django_apps
Terminal&gt; cd django_apps
</pre></div>
</div>
<p>The file <code class="docutils literal"><span class="pre">hw.py</span></code> is moved to <code class="docutils literal"><span class="pre">orig</span></code> while <code class="docutils literal"><span class="pre">mvc</span></code> contains
the MVC refactored version with the files <code class="docutils literal"><span class="pre">model.py</span></code>, <code class="docutils literal"><span class="pre">view.py</span></code>, <code class="docutils literal"><span class="pre">compute.py</span></code>,
and <code class="docutils literal"><span class="pre">controller.py</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">hw1</span></code> directory, containing our first Django application, must be
made with</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python ../../django_project/manage.py startapp hw1
</pre></div>
</div>
<p>The command creates a directory <code class="docutils literal"><span class="pre">hw1</span></code> with four empty files:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; cd hw1
Terminal&gt; ls
__init__.py models.py tests.py views.py
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">__init__.py</span></code> file will remain empty to just indicate that the
Django application is a Python package. The other files need to be
filled with the right content, which happens in the next section.</p>
<p>At this point,
we need to register some information about our application in the
<code class="docutils literal"><span class="pre">django_project/settings.py</span></code> and <code class="docutils literal"><span class="pre">django_project/urls.py</span></code> files.</p>
<p><strong>Step 1: Add the app.</strong>
Locate the <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code>
tuple in <code class="docutils literal"><span class="pre">settings.py</span></code> and add your Django application as a Python package:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="o">...</span>
    <span class="s">&#39;hw1&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Unfortunately, Django will not be able to find the package <code class="docutils literal"><span class="pre">hw1</span></code>
unless we register the parent directory in <code class="docutils literal"><span class="pre">sys.path</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">relative2absolute_path</span><span class="p">(</span><span class="s">&#39;../../apps/django_apps&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Note here that the relative path is given with respect to the
location of the <code class="docutils literal"><span class="pre">settings.py</span></code> script.</p>
<p><strong>Step 2: Add a template directory.</strong>
Make a subdirectory <code class="docutils literal"><span class="pre">templates</span></code> under <code class="docutils literal"><span class="pre">hw1</span></code>,</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; mkdir templates
</pre></div>
</div>
<p>and add the absolute path of this directory to the <code class="docutils literal"><span class="pre">TEMPLATE_DIRS</span></code> tuple:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">TEMPLATE_DIRS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">relative2absolute_path</span><span class="p">(</span><span class="s">&#39;../../apps/django_apps/hw1/templates&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">templates</span></code> directory will hold templates for the HTML code applied
in the web interfaces. The trailing comma is important as this is
a tuple with only one element.</p>
<p><strong>Step 3: Define the URL.</strong>
We need to connect the Django app with
an URL. Our app will be associated with a Python function <code class="docutils literal"><span class="pre">index</span></code>
in the <code class="docutils literal"><span class="pre">views</span></code> module within the <code class="docutils literal"><span class="pre">hw1</span></code> package.
Say we want the corresponding URL to
be named <code class="docutils literal"><span class="pre">hw1</span></code> relative to the server URL.
This information is registered in the <code class="docutils literal"><span class="pre">django_project/urls.py</span></code> file
by the syntax</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^hw1/&#39;</span><span class="p">,</span> <span class="s">&#39;django_apps.hw1.views.index&#39;</span><span class="p">),</span>
</pre></div>
</div>
<p>The first argument to the <code class="docutils literal"><span class="pre">url</span></code> function is a regular expression for
the URL and the second argument is the name of the function to call,
using Python&#8217;s syntax for a function <code class="docutils literal"><span class="pre">index</span></code> in a module <code class="docutils literal"><span class="pre">views</span></code> in
a package <code class="docutils literal"><span class="pre">hw1</span></code>.
The function name <code class="docutils literal"><span class="pre">index</span></code> resembles the <code class="docutils literal"><span class="pre">index.html</span></code> main page associated
with an URL, but any other name than <code class="docutils literal"><span class="pre">index</span></code> can be used.</p>
</div>
<div class="section" id="programming-the-django-application-1">
<h2>Programming the Django application  (1)<a class="headerlink" href="#programming-the-django-application-1" title="Permalink to this headline">¶</a></h2>
<p>The Django application is about filling the files <code class="docutils literal"><span class="pre">views.py</span></code> and <code class="docutils literal"><span class="pre">models.py</span></code>
with content. The mathematical computations are performed in <code class="docutils literal"><span class="pre">compute.py</span></code>
so we copy this file from the <code class="docutils literal"><span class="pre">mvc</span></code> directory to the <code class="docutils literal"><span class="pre">hw1</span></code> directory
for convenience (we could alternatively add <code class="docutils literal"><span class="pre">../mvc</span></code> to <code class="docutils literal"><span class="pre">sys.path</span></code> such that
<code class="docutils literal"><span class="pre">import</span> <span class="pre">compute</span></code> would work from the <code class="docutils literal"><span class="pre">hw1</span></code> directory).</p>
<div class="section" id="the-user-interaction-2">
<h3>The user interaction  (2)<a class="headerlink" href="#the-user-interaction-2" title="Permalink to this headline">¶</a></h3>
<p>The web application offers a text field where the user can
write the value of <code class="docutils literal"><span class="pre">r</span></code>, see Figure <a class="reference internal" href="#wf-hw1-django-fig-input"><span class="std std-ref">The input page</span></a>.
After clicking on the <em>equals</em> button,
the mathematics is performed and a new page as
seen in Figure <a class="reference internal" href="#wf-hw1-django-fig-result"><span class="std std-ref">The result page</span></a> appears.</p>
<div class="figure" id="id1">
<span id="wf-hw1-django-fig-input"></span><a class="reference internal image-reference" href="_images/hw1_django_input.png"><img alt="_images/hw1_django_input.png" src="_images/hw1_django_input.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text"><em>The input page</em></span></p>
</div>
<div class="figure" id="id2">
<span id="wf-hw1-django-fig-result"></span><a class="reference internal image-reference" href="_images/hw1_django_output.png"><img alt="_images/hw1_django_output.png" src="_images/hw1_django_output.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text"><em>The result page</em></span></p>
</div>
<span class="target" id="index-3"></span></div>
<div class="section" id="the-model-1">
<span id="index-4"></span><h3>The model  (1)<a class="headerlink" href="#the-model-1" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">models.py</span></code> file contains the model, which consists
of the data we need in the application, stored in Django&#8217;s data types.
Our data consists of one number, called <code class="docutils literal"><span class="pre">r</span></code>, and <code class="docutils literal"><span class="pre">models.py</span></code> then
look like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">ModelForm</span>

<span class="k">class</span> <span class="nc">Input</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">InputForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Input</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">Input</span></code> class lists variables representing data as static class
attributes. The <code class="docutils literal"><span class="pre">django.db.models</span></code> module contains various classes
for different types of data, here we use <code class="docutils literal"><span class="pre">FloatField</span></code> to represent
a floating-point number.
The <code class="docutils literal"><span class="pre">InputForm</span></code> class has a the shown generic form across applications
if we by convention apply the name <code class="docutils literal"><span class="pre">Input</span></code> for the class holding the data.</p>
<span class="target" id="index-5"></span></div>
<div class="section" id="the-view-1">
<span id="index-6"></span><h3>The view  (1)<a class="headerlink" href="#the-view-1" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">views.py</span></code> file contains a function <code class="docutils literal"><span class="pre">index</span></code> which defines
the actions we want to perform when invoking
the URL ( here <code class="docutils literal"><span class="pre">http://127.0.0.1:8000/hw1/</span></code>).
In addition, <code class="docutils literal"><span class="pre">views.py</span></code> has the <code class="docutils literal"><span class="pre">present_output</span></code> function from
the <code class="docutils literal"><span class="pre">view.py</span></code> file in the <code class="docutils literal"><span class="pre">mvc</span></code> directory.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">RequestContext</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">InputForm</span>
<span class="kn">from</span> <span class="nn">compute</span> <span class="kn">import</span> <span class="n">compute</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">InputForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">present_output</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">InputForm</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;hw1.html&#39;</span><span class="p">,</span>
            <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">},</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">present_output</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">r</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">compute</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&#39;Hello, World! sin(</span><span class="si">%s</span><span class="s">)=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">index</span></code> function deserves some explanation. It must take one
argument, usually called <code class="docutils literal"><span class="pre">request</span></code>. There are two modes in the function. Either
the user has provided input on the web page, which means that
<code class="docutils literal"><span class="pre">request.method</span></code> equals <code class="docutils literal"><span class="pre">'POST'</span></code>, or we show a new web page
with which the user is supposed to interact.</p>
</div>
<div class="section" id="making-the-input-page">
<span id="index-7"></span><h3>Making the input page<a class="headerlink" href="#making-the-input-page" title="Permalink to this headline">¶</a></h3>
<p>The input consists of a web form with
one field where we can fill in our <code class="docutils literal"><span class="pre">r</span></code> variable. This page
is realized by the two central statements</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Make info needed in the web form</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">InputForm</span><span class="p">()</span>
<span class="c"># Make HTML code</span>
<span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;hw1.html&#39;</span><span class="p">,</span>
    <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">},</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">hw1.html</span></code> file resides in the <code class="docutils literal"><span class="pre">templates</span></code> subdirectory and contains
a template for the HTML code:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>{% csrf_token %}
    Hello, World! The sine of {{ form.r }}
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;equals&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<p>This is a <em>template file</em> because it contains instructions like
<code class="docutils literal"><span class="pre">{%</span> <span class="pre">csrf_token</span> <span class="pre">%}</span></code> and variables like <code class="docutils literal"><span class="pre">{{</span> <span class="pre">form.r</span> <span class="pre">}}</span></code>. Django will
replace the former by some appropriate HTML statements, while the
latter simply extracts the numerical value of the variable <code class="docutils literal"><span class="pre">r</span></code> in
our form (specified in the <code class="docutils literal"><span class="pre">Input</span></code> class in <code class="docutils literal"><span class="pre">models.py</span></code>).
Typically, this <code class="docutils literal"><span class="pre">hw1.html</span></code> file
results in the HTML code</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&#39;display:none&#39;</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;hidden&#39;</span> <span class="na">name=</span><span class="s">&#39;csrfmiddlewaretoken&#39;</span>
<span class="na">value=</span><span class="s">&#39;oPWMuuy1gLlXm9GvUZINv49eVUYnux5Q&#39;</span> <span class="nt">/&gt;&lt;/div&gt;</span>
    Hello, World! The sine of <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;r&quot;</span> <span class="na">id=</span><span class="s">&quot;id_r&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;equals&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="making-the-results-page">
<h3>Making the results page<a class="headerlink" href="#making-the-results-page" title="Permalink to this headline">¶</a></h3>
<p>When then user has filled in a value in the text field on the input
page, the <code class="docutils literal"><span class="pre">index</span></code> function is called again and <code class="docutils literal"><span class="pre">request.method</span></code> equals
<code class="docutils literal"><span class="pre">'POST'</span></code>. A new form object is made, this time with user info (<code class="docutils literal"><span class="pre">request.POST</span></code>).
We can check that the form is valid and if so, proceed with
computations followed by presenting the results in a
new web page (see Figure <a class="reference internal" href="#wf-hw1-django-fig-result"><span class="std std-ref">The result page</span></a>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">InputForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">present_output</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">present_output</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">r</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">compute</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&#39;Hello, World! sin(</span><span class="si">%s</span><span class="s">)=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
<p>The numerical value of <code class="docutils literal"><span class="pre">r</span></code> as given by the user is available as <code class="docutils literal"><span class="pre">form.r</span></code>.
Instead of using a template for the output page, which is natural to
do in more advanced cases, we here illustrate the possibility to
send raw HTML to the output page by returning an <code class="docutils literal"><span class="pre">HttpResponse</span></code>
object initialized by a string containing the desired HTML code.</p>
<p>Launch this application by filling in the address <code class="docutils literal"><span class="pre">http://127.0.0.1:8000/hw1/</span></code>
in your web browser. Make sure the Django development server is running,
and if not, restart it by</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python ../../../django_project/manage.py runserver
</pre></div>
</div>
<p>Fill
in some number on the input page and view the output.
To show how easy it is to change the application, invoke the <code class="docutils literal"><span class="pre">views.py</span></code>
file in an editor and add some color to the output HTML code from
the <code class="docutils literal"><span class="pre">present_output</span></code> function:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">&lt;font color=&#39;blue&#39;&gt;Hello&lt;/font&gt;, World!</span>
<span class="s">sin(</span><span class="si">%s</span><span class="s">)=</span><span class="si">%s</span><span class="s"></span>
<span class="s">&quot;&quot;&quot;</span><span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
<p>Go back to the input page, provide a new number, and observe how
the &#8220;Hello&#8221; word now has a blue color.</p>
</div>
</div>
<div class="section" id="equipping-the-input-page-with-output-results-2">
<h2>Equipping the input page with output results  (2)<a class="headerlink" href="#equipping-the-input-page-with-output-results-2" title="Permalink to this headline">¶</a></h2>
<p>Instead of making a separate output page with the result, we can
simply add the sine value to the input page. This makes the user
feel that she interacts with the same page, as when operating a calculator.
The output page should then look as shown in Figure <a class="reference internal" href="#wf-hw2-django-fig-result"><span class="std std-ref">The modified result page</span></a>.</p>
<div class="figure" id="id3">
<span id="wf-hw2-django-fig-result"></span><a class="reference internal image-reference" href="_images/hw2_django_output.png"><img alt="_images/hw2_django_output.png" src="_images/hw2_django_output.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text"><em>The modified result page</em></span></p>
</div>
<p>We need to make a new Django application, now called
<a class="reference external" href="https://github.com/hplgit/web4sciapps/tree/master/doc/src/web4sa/src-web4sa/apps/django_apps/hw2">hw2</a>.
Instead of running the standard
<code class="docutils literal"><span class="pre">manage.py</span> <span class="pre">startapp</span> <span class="pre">hw2</span></code> command,
we can simply copy the <code class="docutils literal"><span class="pre">hw1</span></code>
directory to <code class="docutils literal"><span class="pre">hw2</span></code>. We need, of course, to add information about this
new application in <code class="docutils literal"><span class="pre">settings.py</span></code> and <code class="docutils literal"><span class="pre">urls.py</span></code>.
In the former file we must have</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">TEMPLATE_DIRS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">relative2absolute_path</span><span class="p">(</span><span class="s">&#39;../../apps/django_apps/hw1/templates&#39;</span><span class="p">),</span>
    <span class="n">relative2absolute_path</span><span class="p">(</span><span class="s">&#39;../../apps/django_apps/hw2/templates&#39;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="c"># &#39;django.contrib.admin&#39;,</span>
    <span class="c"># Uncomment the next line to enable admin documentation:</span>
    <span class="c"># &#39;django.contrib.admindocs&#39;,</span>
    <span class="s">&#39;hw1&#39;</span><span class="p">,</span>
    <span class="s">&#39;hw2&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In <code class="docutils literal"><span class="pre">urls.py</span></code> we add the URL <code class="docutils literal"><span class="pre">hw2</span></code> which is to call our <code class="docutils literal"><span class="pre">index</span></code> function
in the <code class="docutils literal"><span class="pre">views.py</span></code> file of the <code class="docutils literal"><span class="pre">hw2</span></code> app:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^hw1/&#39;</span><span class="p">,</span> <span class="s">&#39;django_apps.hw1.views.index&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^hw2/&#39;</span><span class="p">,</span> <span class="s">&#39;django_apps.hw2.views.index&#39;</span><span class="p">),</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">views.py</span></code> file changes a bit since we shall generate almost the same
web page on input and output. This makes the <code class="docutils literal"><span class="pre">present_output</span></code> function
unnatural, and everything is done within the <code class="docutils literal"><span class="pre">index</span></code> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># initial value of result</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">InputForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">r</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">compute</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">InputForm</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;hw2.html&#39;</span><span class="p">,</span>
            <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
             <span class="s">&#39;s&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%.5f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">s</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
             <span class="p">},</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that the output variable <code class="docutils literal"><span class="pre">s</span></code> is computed within the <code class="docutils literal"><span class="pre">index</span></code>
function and defaults to <code class="docutils literal"><span class="pre">None</span></code>. The template file <code class="docutils literal"><span class="pre">hw2.html</span></code>
looks like</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>{% csrf_token %}
    Hello, World! The sine of {{ form.r }}
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;equals&quot;</span> <span class="nt">/&gt;</span>
{% if s != &#39;&#39; %}
{{ s }}
{% endif %}
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<p>The difference from <code class="docutils literal"><span class="pre">hw1.html</span></code> is that we right after the <em>equals</em>
button write out the value of <code class="docutils literal"><span class="pre">s</span></code>. However, we make a test that
the value is only written if it is computed, here recognized by
being a non-empty string. The <code class="docutils literal"><span class="pre">s</span></code> in the template file
is substituted by the value of the object
corresponding to the key <code class="docutils literal"><span class="pre">'s'</span></code> in the
dictionary we pass to the <code class="docutils literal"><span class="pre">render_to_response</span></code>. As seen,
we pass a string where <code class="docutils literal"><span class="pre">s</span></code> is formatted with five digits if <code class="docutils literal"><span class="pre">s</span></code>
is a float, i.e., if <code class="docutils literal"><span class="pre">s</span></code> is computed. Otherwise, <code class="docutils literal"><span class="pre">s</span></code> has the
default value <code class="docutils literal"><span class="pre">None</span></code> and we send an empty string to the template.
The template language allows tests using Python syntax, but the
if-block must be explicitly ended by <code class="docutils literal"><span class="pre">{%</span> <span class="pre">endif</span> <span class="pre">%}</span></code>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinxlocaltoc">
    <h3><a href="index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Making a Django application</a><ul>
<li><a class="reference internal" href="#setting-up-a-django-project">Setting up a Django project</a></li>
<li><a class="reference internal" href="#setting-up-a-django-application">Setting up a Django application</a></li>
<li><a class="reference internal" href="#programming-the-django-application-1">Programming the Django application  (1)</a><ul>
<li><a class="reference internal" href="#the-user-interaction-2">The user interaction  (2)</a></li>
<li><a class="reference internal" href="#the-model-1">The model  (1)</a></li>
<li><a class="reference internal" href="#the-view-1">The view  (1)</a></li>
<li><a class="reference internal" href="#making-the-input-page">Making the input page</a></li>
<li><a class="reference internal" href="#making-the-results-page">Making the results page</a></li>
</ul>
</li>
<li><a class="reference internal" href="#equipping-the-input-page-with-output-results-2">Equipping the input page with output results  (2)</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="._web4sa002.html"
                          title="Previous page">&larr; Making a Flask application</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="._web4sa004.html"
                          title="Next page">&rarr; Handling multiple input variables in Flask</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/._web4sa003.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="._web4sa004.html" title="Handling multiple input variables in Flask"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="._web4sa002.html" title="Making a Flask application"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">Using Web Frameworks for Scientific Applications</a> &raquo;</li>
 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright H. P. Langtangen and A. E. Johansen.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4a0+.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>