
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Programming the Django application (1) &mdash; Using Web Frameworks for Scientific Web Applications</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-2.3.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-2.3.0/css/bootstrap-responsive.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-2.3.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Using Web Frameworks for Scientific Web Applications" href="index.html" />
    <link rel="next" title="Handling multiple input variables in Flask" href="._web4sa008.html" />
    <link rel="prev" title="Making a Django application" href="._web4sa006.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>
<div class="container">
  
  <div id="navbar" class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a class="brand" href="index.html">Using Web Frameworks for Scientific Web Applications</a>
      <span class="navbar-text pull-left"><b>1.0</b></span>

      <div class="nav-collapse">
        <ul class="nav">
          <li class="divider-vertical"></li>
          
            <li class="dropdown globaltoc-container">
  <a href="index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="._web4sa000.html">Using Web Frameworks for Scientific Web Applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="._web4sa000.html#web-frameworks">Web frameworks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa001.html">The MVC pattern</a></li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa002.html">A very simple application</a></li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa003.html">Application of the MVC pattern</a></li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa004.html">Making a Flask application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="._web4sa004.html#programming-the-flask-application-1">Programming the Flask application  (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="._web4sa004.html#equipping-the-input-page-with-output-results-1">Equipping the input page with output results  (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="._web4sa004.html#splitting-the-app-into-model-view-and-controller-files">Splitting the app into model, view, and controller files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa005.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa006.html">Making a Django application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="._web4sa006.html#setting-up-a-django-project">Setting up a Django project</a></li>
<li class="toctree-l2"><a class="reference internal" href="._web4sa006.html#setting-up-a-django-application">Setting up a Django application</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Programming the Django application  (1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="#equipping-the-input-page-with-output-results-2">Equipping the input page with output results  (2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa008.html">Handling multiple input variables in Flask</a><ul>
<li class="toctree-l2"><a class="reference internal" href="._web4sa008.html#programming-the-flask-application-2">Programming the Flask application  (2)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa009.html">Implementing error checking in the template</a></li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa010.html">Using style sheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa010.html#using-latex-mathematics">Using LaTeX mathematics</a></li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa010.html#rearringing-the-elements-in-the-html-template">Rearringing the elements in the HTML template</a></li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa011.html">Custom validation  (1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa012.html">Autogenerating the code</a></li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa013.html">Avoiding plot files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="._web4sa013.html#png-plots">PNG plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="._web4sa013.html#svg-plots">SVG plots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa014.html">User login and storage of computed results</a></li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa015.html">Using Bootstrap styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa016.html">Further work</a><ul>
<li class="toctree-l2"><a class="reference internal" href="._web4sa016.html#resources-1">Resources  (1)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa017.html">Handling multiple input variables in Django</a><ul>
<li class="toctree-l2"><a class="reference internal" href="._web4sa017.html#programming-the-django-application-2">Programming the Django application  (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="._web4sa017.html#custom-validation-2">Custom validation  (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="._web4sa017.html#customizing-widgets">Customizing widgets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa018.html">Exercises</a><ul>
<li class="toctree-l2"><a class="reference internal" href="._web4sa018.html#exercise-1-add-two-numbers">Exercise 1: Add two numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="._web4sa018.html#exercise-2-extend-the-vib3-flask-app">Exercise 2: Extend the <tt class="docutils literal"><span class="pre">vib3_flask</span></tt> app</a></li>
<li class="toctree-l2"><a class="reference internal" href="._web4sa018.html#exercise-3-equip-the-vib3-flask-app-with-more-data-types">Exercise 3: Equip the <tt class="docutils literal"><span class="pre">vib3_flask</span></tt> app with more data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="._web4sa018.html#exercise-4-auto-generate-code-from-function-signature">Exercise 4: Auto-generate code from function signature</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa018.html#resources-2">Resources  (2)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="._web4sa018.html#flask-resources">Flask resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="._web4sa018.html#django-resources">Django resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="._web4sa018.html#remaining">Remaining</a></li>
</ul>
</ul>
</li>
            <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Programming the Django application  (1)</a></li>
<li><a class="reference internal" href="#equipping-the-input-page-with-output-results-2">Equipping the input page with output results  (2)</a></li>
</ul>
</ul>
</li>
          
          
            
  <li><a href="._web4sa006.html"
         title="previous chapter">&laquo; Making a Django application</a></li>
  <li><a href="._web4sa008.html"
         title="next chapter">Handling multiple input variables in Flask &raquo;</a></li>
          
          
            <li>
  <a href="_sources/._web4sa007.txt"
     rel="nofollow">Source</a></li>
          
        </ul>

        
          
<form class="navbar-search pull-right" style="margin-bottom:-3px;" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

  
  <div class="section" id="programming-the-django-application-1">
<h1>Programming the Django application  (1)<a class="headerlink" href="#programming-the-django-application-1" title="Permalink to this headline">¶</a></h1>
<p>The Django application is about filling the files <tt class="docutils literal"><span class="pre">views.py</span></tt> and <tt class="docutils literal"><span class="pre">models.py</span></tt>
with content. The mathematical computations are performed in <tt class="docutils literal"><span class="pre">compute.py</span></tt>
so we copy this file from the <tt class="docutils literal"><span class="pre">mvc</span></tt> directory to the <tt class="docutils literal"><span class="pre">hw1</span></tt> directory
for convenience (we could alternatively add <tt class="docutils literal"><span class="pre">../mvc</span></tt> to <tt class="docutils literal"><span class="pre">sys.path</span></tt> such that
<tt class="docutils literal"><span class="pre">import</span> <span class="pre">compute</span></tt> would work from the <tt class="docutils literal"><span class="pre">hw1</span></tt> directory).</p>
<p><strong>The user interaction.</strong>
The web application offers a text field where the user can
write the value of <tt class="docutils literal"><span class="pre">r</span></tt>, see Figure <a class="reference internal" href="#wf-hw1-django-fig-input"><em>The input page</em></a>.
After clicking on the <em>equals</em> button,
the mathematics is performed and a new page as
seen in Figure <a class="reference internal" href="#wf-hw1-django-fig-result"><em>The result page</em></a> appears.</p>
<div class="figure" id="wf-hw1-django-fig-input">
<img alt="_images/hw1_django_input.png" src="_images/hw1_django_input.png" style="width: 600px;" />
<p class="caption"><em>The input page</em></p>
</div>
<div class="figure" id="wf-hw1-django-fig-result">
<img alt="_images/hw1_django_output.png" src="_images/hw1_django_output.png" style="width: 600px;" />
<p class="caption"><em>The result page</em></p>
</div>
<span class="target" id="index-0"></span><p id="index-1"><strong>The model.</strong>
The <tt class="docutils literal"><span class="pre">models.py</span></tt> file contains the model, which consists
of the data we need in the application, stored in Django&#8217;s data types.
Our data consists of one number, called <tt class="docutils literal"><span class="pre">r</span></tt>, and <tt class="docutils literal"><span class="pre">models.py</span></tt> then
look like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">ModelForm</span>

<span class="k">class</span> <span class="nc">Input</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">InputForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Input</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">Input</span></tt> class lists variables representing data as static class
attributes. The <tt class="docutils literal"><span class="pre">django.db.models</span></tt> module contains various classes
for different types of data, here we use <tt class="docutils literal"><span class="pre">FloatField</span></tt> to represent
a floating-point number.
The <tt class="docutils literal"><span class="pre">InputForm</span></tt> class has a the shown generic form across applications
if we by convention apply the name <tt class="docutils literal"><span class="pre">Input</span></tt> for the class holding the data.</p>
<span class="target" id="index-2"></span><p id="index-3"><strong>The view.</strong>
The <tt class="docutils literal"><span class="pre">views.py</span></tt> file contains a function <tt class="docutils literal"><span class="pre">index</span></tt> which defines
the actions we want to perform when invoking
the URL ( here <tt class="docutils literal"><span class="pre">http://127.0.0.1:8000/hw1/</span></tt>).
In addition, <tt class="docutils literal"><span class="pre">views.py</span></tt> has the <tt class="docutils literal"><span class="pre">present_output</span></tt> function from
the <tt class="docutils literal"><span class="pre">view.py</span></tt> file in the <tt class="docutils literal"><span class="pre">mvc</span></tt> directory.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">RequestContext</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">InputForm</span>
<span class="kn">from</span> <span class="nn">compute</span> <span class="kn">import</span> <span class="n">compute</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">InputForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">present_output</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">InputForm</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;hw1.html&#39;</span><span class="p">,</span>
            <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">},</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">present_output</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">r</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">compute</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&#39;Hello, World! sin(</span><span class="si">%s</span><span class="s">)=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">index</span></tt> function deserves some explanation. It must take one
argument, usually called <tt class="docutils literal"><span class="pre">request</span></tt>. There are two modes in the function. Either
the user has provided input on the web page, which means that
<tt class="docutils literal"><span class="pre">request.method</span></tt> equals <tt class="docutils literal"><span class="pre">'POST'</span></tt>, or we show a new web page
with which the user is supposed to interact.</p>
<p id="index-4"><strong>Making the input page.</strong>
The input consists of a web form with
one field where we can fill in our <tt class="docutils literal"><span class="pre">r</span></tt> variable. This page
is realized by the two central statements</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Make info needed in the web form</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">InputForm</span><span class="p">()</span>
<span class="c"># Make HTML code</span>
<span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;hw1.html&#39;</span><span class="p">,</span>
    <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">},</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">hw1.html</span></tt> file resides in the <tt class="docutils literal"><span class="pre">templates</span></tt> subdirectory and contains
a template for the HTML code:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>{% csrf_token %}
    Hello, World! The sine of {{ form.r }}
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;equals&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<p>This is a <em>template file</em> because it contains instructions like
<tt class="docutils literal"><span class="pre">{%</span> <span class="pre">csrf_token</span> <span class="pre">%}</span></tt> and variables like <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">form.r</span> <span class="pre">}}</span></tt>. Django will
replace the former by some appropriate HTML statements, while the
latter simply extracts the numerical value of the variable <tt class="docutils literal"><span class="pre">r</span></tt> in
our form (specified in the <tt class="docutils literal"><span class="pre">Input</span></tt> class in <tt class="docutils literal"><span class="pre">models.py</span></tt>).
Typically, this <tt class="docutils literal"><span class="pre">hw1.html</span></tt> file
results in the HTML code</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&#39;display:none&#39;</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;hidden&#39;</span> <span class="na">name=</span><span class="s">&#39;csrfmiddlewaretoken&#39;</span>
<span class="na">value=</span><span class="s">&#39;oPWMuuy1gLlXm9GvUZINv49eVUYnux5Q&#39;</span> <span class="nt">/&gt;&lt;/div&gt;</span>
    Hello, World! The sine of <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;r&quot;</span> <span class="na">id=</span><span class="s">&quot;id_r&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;equals&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<p><strong>Making the results page.</strong>
When then user has filled in a value in the text field on the input
page, the <tt class="docutils literal"><span class="pre">index</span></tt> function is called again and <tt class="docutils literal"><span class="pre">request.method</span></tt> equals
<tt class="docutils literal"><span class="pre">'POST'</span></tt>. A new form object is made, this time with user info (<tt class="docutils literal"><span class="pre">request.POST</span></tt>).
We can check that the form is valid and if so, proceed with
computations followed by presenting the results in a
new web page (see Figure <a class="reference internal" href="#wf-hw1-django-fig-result"><em>The result page</em></a>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">InputForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">present_output</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">present_output</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">r</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">compute</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&#39;Hello, World! sin(</span><span class="si">%s</span><span class="s">)=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
<p>The numerical value of <tt class="docutils literal"><span class="pre">r</span></tt> as given by the user is available as <tt class="docutils literal"><span class="pre">form.r</span></tt>.
Instead of using a template for the output page, which is natural to
do in more advanced cases, we here illustrate the possibility to
send raw HTML to the output page by returning an <tt class="docutils literal"><span class="pre">HttpResponse</span></tt>
object initialized by a string containing the desired HTML code.</p>
<p>Launch this application by filling in the address <tt class="docutils literal"><span class="pre">http://127.0.0.1:8000/hw1/</span></tt>
in your web browser. Make sure the Django development server is running,
and if not, restart it by</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python ../../../django_project/manage.py runserver
</pre></div>
</div>
<p>Fill
in some number on the input page and view the output.
To show how easy it is to change the application, invoke the <tt class="docutils literal"><span class="pre">views.py</span></tt>
file in an editor and add some color to the output HTML code from
the <tt class="docutils literal"><span class="pre">present_output</span></tt> function:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">&lt;font color=&#39;blue&#39;&gt;Hello&lt;/font&gt;, World!</span>
<span class="s">sin(</span><span class="si">%s</span><span class="s">)=</span><span class="si">%s</span><span class="s"></span>
<span class="s">&quot;&quot;&quot;</span><span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
<p>Go back to the input page, provide a new number, and observe how
the &#8220;Hello&#8221; word now has a blue color.</p>
</div>
<div class="section" id="equipping-the-input-page-with-output-results-2">
<h1>Equipping the input page with output results  (2)<a class="headerlink" href="#equipping-the-input-page-with-output-results-2" title="Permalink to this headline">¶</a></h1>
<p>Instead of making a separate output page with the result, we can
simply add the sine value to the input page. This makes the user
feel that she interacts with the same page, as when operating a calculator.
The output page should then look as shown in Figure <a class="reference internal" href="#wf-hw2-django-fig-result"><em>The modified result page</em></a>.</p>
<div class="figure" id="wf-hw2-django-fig-result">
<img alt="_images/hw2_django_output.png" src="_images/hw2_django_output.png" style="width: 600px;" />
<p class="caption"><em>The modified result page</em></p>
</div>
<p>We need to make a new Django application, now called
<a class="reference external" href="https://github.com/hplgit/web4sciapps/tree/master/doc/src/web4sa/src-web4sa/apps/django_apps/hw2">hw2</a>.
Instead of running the standard
<tt class="docutils literal"><span class="pre">manage.py</span> <span class="pre">startapp</span> <span class="pre">hw2</span></tt> command,
we can simply copy the <tt class="docutils literal"><span class="pre">hw1</span></tt>
directory to <tt class="docutils literal"><span class="pre">hw2</span></tt>. We need, of course, to add information about this
new application in <tt class="docutils literal"><span class="pre">settings.py</span></tt> and <tt class="docutils literal"><span class="pre">urls.py</span></tt>.
In the former file we must have</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">TEMPLATE_DIRS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">relative2absolute_path</span><span class="p">(</span><span class="s">&#39;../../apps/django_apps/hw1/templates&#39;</span><span class="p">),</span>
    <span class="n">relative2absolute_path</span><span class="p">(</span><span class="s">&#39;../../apps/django_apps/hw2/templates&#39;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="c"># &#39;django.contrib.admin&#39;,</span>
    <span class="c"># Uncomment the next line to enable admin documentation:</span>
    <span class="c"># &#39;django.contrib.admindocs&#39;,</span>
    <span class="s">&#39;hw1&#39;</span><span class="p">,</span>
    <span class="s">&#39;hw2&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In <tt class="docutils literal"><span class="pre">urls.py</span></tt> we add the URL <tt class="docutils literal"><span class="pre">hw2</span></tt> which is to call our <tt class="docutils literal"><span class="pre">index</span></tt> function
in the <tt class="docutils literal"><span class="pre">views.py</span></tt> file of the <tt class="docutils literal"><span class="pre">hw2</span></tt> app:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^hw1/&#39;</span><span class="p">,</span> <span class="s">&#39;django_apps.hw1.views.index&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^hw2/&#39;</span><span class="p">,</span> <span class="s">&#39;django_apps.hw2.views.index&#39;</span><span class="p">),</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">views.py</span></tt> file changes a bit since we shall generate almost the same
web page on input and output. This makes the <tt class="docutils literal"><span class="pre">present_output</span></tt> function
unnatural, and everything is done within the <tt class="docutils literal"><span class="pre">index</span></tt> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># initial value of result</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">InputForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">r</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">compute</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">InputForm</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;hw2.html&#39;</span><span class="p">,</span>
            <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
             <span class="s">&#39;s&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%.5f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">s</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
             <span class="p">},</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that the output variable <tt class="docutils literal"><span class="pre">s</span></tt> is computed within the <tt class="docutils literal"><span class="pre">index</span></tt>
function and defaults to <tt class="docutils literal"><span class="pre">None</span></tt>. The template file <tt class="docutils literal"><span class="pre">hw2.html</span></tt>
looks like</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>{% csrf_token %}
    Hello, World! The sine of {{ form.r }}
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;equals&quot;</span> <span class="nt">/&gt;</span>
{% if s != &#39;&#39; %}
{{ s }}
{% endif %}
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<p>The difference from <tt class="docutils literal"><span class="pre">hw1.html</span></tt> is that we right after the <em>equals</em>
button write out the value of <tt class="docutils literal"><span class="pre">s</span></tt>. However, we make a test that
the value is only written if it is computed, here recognized by
being a non-empty string. The <tt class="docutils literal"><span class="pre">s</span></tt> in the template file
is substituted by the value of the object
corresponding to the key <tt class="docutils literal"><span class="pre">'s'</span></tt> in the
dictionary we pass to the <tt class="docutils literal"><span class="pre">render_to_response</span></tt>. As seen,
we pass a string where <tt class="docutils literal"><span class="pre">s</span></tt> is formatted with five digits if <tt class="docutils literal"><span class="pre">s</span></tt>
is a float, i.e., if <tt class="docutils literal"><span class="pre">s</span></tt> is computed. Otherwise, <tt class="docutils literal"><span class="pre">s</span></tt> has the
default value <tt class="docutils literal"><span class="pre">None</span></tt> and we send an empty string to the template.
The template language allows tests using Python syntax, but the
if-block must be explicitly ended by <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">endif</span> <span class="pre">%}</span></tt>.</p>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014, H. P. Langtangen and A. E. Johansen.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>