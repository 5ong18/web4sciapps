<html>
<head>
<!--
This style is adopted from the (now old) vagrant 1.0 web
pages. The style builds on the Twitter Bootstrap style.
Modifications by Hans Petter Langtangen, hpl@simula.no.

This style file should be copied and the following
elements edited:

Logo heading:

 LogoWord
 withSubWord

Navigation links at the top:

 GO TO 1
 GO TO 2

Footer at the end:

 Here goes a footer, if desired, maybe with a Copyright &copy;

-->

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Doconce: http://code.google.com/p/doconce/" />

<link rel="stylesheet" href="html_templates/css/twitter_bootstrap.css">
<link rel="stylesheet" href="html_templates/css/vagrant.css">
<!-- Define color of headings here (last definition counts) -->
<style type="text/css">
h1, h2, h3, h4, h5, h6 {
  color: #000;     /* black */
  color: #999;     /* gray */
  color: #005580;  /* dark blue */
  color: #08c;     /* characteristic blue */
</style>
</head>
<body>

<title> Exercise 3: Auto-generate code from function signature </title>

<!-- ------------------- main content ------------------------>

<div class="container">
 <div class="row Header with-border">
  <div class="span3 Module logo">
   <h1><a href="/">Flask<span class="subtitle">4scientists</span></a></h1>
  </div>
  <div class="span9">
   <div class="Module navigation">
   <!-- Navigation at the top of the page -->
    <ul>
     <li> <a href="http://flask.pocoo.org/">Flask</a></li>
    </ul>
   </div>
  </div>
 </div>
</div>


<!-- Here goes the table of contents in the sidebar
     <li class="active"> means dark blue background for current section
-->
<div class="row">
 <div class="span3 Module sidebar">
  <div class="well" style="padding: 8px 0px;">
   <ul class="nav nav-list">
     <!-- Syntax:
     <li> <a href="...">Section 1</a></li>
     <li> <a href="...">Section 2</a></li>
     <li> &nbsp;&nbsp;&nbsp; <a href="...">Section 2a</a></li>
     <li> &nbsp;&nbsp;&nbsp; <a href="...">Section 2b</a></li>
     -->
     <!-- Doconce automatically fills in the table of contents -->
          <!-- vagrant nav toc: " Web frameworks " --> <li>  <a href="._part0000_web4sa_flask.html#___sec0"> Web frameworks </a>
     <!-- vagrant nav toc: " The MVC pattern " --> <li> &nbsp;  <a href="._part0001_web4sa_flask.html#___sec1"> The MVC pattern </a>
     <!-- vagrant nav toc: " A very simple application " --> <li> &nbsp;  <a href="._part0002_web4sa_flask.html#___sec2"> A very simple application </a>
     <!-- vagrant nav toc: " Application of the MVC pattern " --> <li> &nbsp;  <a href="._part0003_web4sa_flask.html#wf:hw:mvc"> Application of the MVC pattern </a>
     <!-- vagrant nav toc: " Making a Flask application " --> <li>  <a href="._part0003_web4sa_flask.html#___sec4"> Making a Flask application </a>
     <!-- vagrant nav toc: " Programming the Flask application " --> <li> &nbsp;  <a href="._part0003_web4sa_flask.html#___sec5"> Programming the Flask application </a>
     <!-- vagrant nav toc: " Equipping the input page with output results " --> <li> &nbsp;  <a href="._part0004_web4sa_flask.html#___sec6"> Equipping the input page with output results </a>
     <!-- vagrant nav toc: " Splitting the app into model, view, and controller files " --> <li> &nbsp;  <a href="._part0005_web4sa_flask.html#wf:hw3:flask"> Splitting the app into model, view, and controller files </a>
     <!-- vagrant nav toc: " Troubleshooting " --> <li> &nbsp;  <a href="._part0005_web4sa_flask.html#___sec8"> Troubleshooting </a>
     <!-- vagrant nav toc: " Handling multiple input variables in Flask " --> <li>  <a href="._part0005_web4sa_flask.html#wf:vib:flask"> Handling multiple input variables in Flask </a>
     <!-- vagrant nav toc: " Programming the Flask application " --> <li> &nbsp;  <a href="._part0006_web4sa_flask.html#___sec10"> Programming the Flask application </a>
     <!-- vagrant nav toc: " Implementing error checking in the template " --> <li> &nbsp;  <a href="._part0007_web4sa_flask.html#___sec11"> Implementing error checking in the template </a>
     <!-- vagrant nav toc: " Using style sheets " --> <li> &nbsp;  <a href="._part0008_web4sa_flask.html#___sec12"> Using style sheets </a>
     <!-- vagrant nav toc: " Using LaTeX mathematics " --> <li> &nbsp;  <a href="._part0009_web4sa_flask.html#___sec13"> Using LaTeX mathematics </a>
     <!-- vagrant nav toc: " User-provided validation " --> <li> &nbsp;  <a href="._part0010_web4sa_flask.html#___sec14"> User-provided validation </a>
     <!-- vagrant nav toc: " Exercise 1: Add two numbers in a Flask app " --> <li> &nbsp;  <a href="._part0010_web4sa_flask.html#wf:exer:flask:add2"> Exercise 1: Add two numbers in a Flask app </a>
     <!-- vagrant nav toc: " Exercise 2: Add two numbers in a Django app " --> <li> &nbsp;  <a href="._part0010_web4sa_flask.html#wf:exer:django:add2"> Exercise 2: Add two numbers in a Django app </a>
     <!-- vagrant nav toc: " Exercise 3: Auto-generate code from function signature " --> <li> &nbsp;  <a href="._part0010_web4sa_flask.html#___sec17"> Exercise 3: Auto-generate code from function signature </a>

    </ul>
   </div>
  </div>

  <div class="span9">


<!-- tocinfo
{'highest level': 1,
 'sections': [(' Web frameworks ', 1, None, '___sec0'),
              (' The MVC pattern ', 2, None, '___sec1'),
              (' A very simple application ', 2, None, '___sec2'),
              (' Application of the MVC pattern ',
               2,
               'wf:hw:mvc',
               'wf:hw:mvc'),
              (' Making a Flask application ', 1, None, '___sec4'),
              (' Programming the Flask application ', 2, None, '___sec5'),
              (' Equipping the input page with output results ',
               2,
               None,
               '___sec6'),
              (' Splitting the app into model, view, and controller files ',
               2,
               'wf:hw3:flask',
               'wf:hw3:flask'),
              (' Troubleshooting ', 2, None, '___sec8'),
              (' Handling multiple input variables in Flask ',
               1,
               'wf:vib:flask',
               'wf:vib:flask'),
              (' Programming the Flask application ', 2, None, '___sec10'),
              (' Implementing error checking in the template ',
               2,
               None,
               '___sec11'),
              (' Using style sheets ', 2, None, '___sec12'),
              (' Using LaTeX mathematics ', 2, None, '___sec13'),
              (' User-provided validation ', 2, None, '___sec14'),
              (' Exercise 1: Add two numbers in a Flask app ',
               2,
               'wf:exer:flask:add2',
               'wf:exer:flask:add2'),
              (' Exercise 2: Add two numbers in a Django app ',
               2,
               'wf:exer:django:add2',
               'wf:exer:django:add2'),
              (' Exercise 3: Auto-generate code from function signature ',
               2,
               None,
               '___sec17')]}
end of tocinfo -->





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- Fix slow MathJax rendering in IE8 -->
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">




<a name="part0004"></a>
<!-- !split -->

<h3>Equipping the input page with output results  <a name="___sec6"></a></h3>

<p>

Our application made two distinct pages for grabbing input from the
user and presenting the result. It is often more natural to add
the result to the input page. This is particularly the case in the present
web application, which is a kind of calculator. Figure <a href="#wf:hw2:flask:fig:result">3</a> shows what the user sees after clicking the <em>equals</em> button.

<p>

<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 3:  The modified result page. <a name="wf:hw2:flask:fig:result"></a> </p></center>
<p><img src="fig-web4sa/hw2_flask_output.png" align="bottom" width=600></p>
</center>

<p>

To let the user stay within the same page, we create a new directory <code>hw2_flask</code>
for this modified Flask app and copy the files from the previous
<code>hw1_flask</code> directory.  The idea now is to make use of just one
template, in <code>templates/view.html</code>:

<p>


<!-- code typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">&lt;form</span> <span style="color: #7D9029">method=</span><span style="color: #BA2121">post</span> <span style="color: #7D9029">action=</span><span style="color: #BA2121">&quot;&quot;</span><span style="color: #008000; font-weight: bold">&gt;</span>
  Hello, World! The sine of
  {{(form.r)}}
  <span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">submit</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">equals</span><span style="color: #008000; font-weight: bold">&gt;</span>
{% if s != None %}
{{s}}
{% endif %}
<span style="color: #008000; font-weight: bold">&lt;/form&gt;</span>
</pre></div>
<p>

The form is identical to what we used in <code>view_input.html</code>, and the only
new thing is the value of <code>s</code>. We supply <code>s</code> as an object to the
<code>render_template</code> function and this object is available for
some programming in the HTML template. We can test on the value of <code>s</code>:
if it is <code>None</code>, we know that the computations are not performed and
<code>s</code> should not appear on the page, otherwise <code>s</code> holds the sine
value and we can write it out. The generated HTML code reads

<p>


<!-- code typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">&lt;form</span> <span style="color: #7D9029">method=</span><span style="color: #BA2121">post</span> <span style="color: #7D9029">action=</span><span style="color: #BA2121">&quot;&quot;</span><span style="color: #008000; font-weight: bold">&gt;</span>
  Hello, World! The sine of
  <span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">id=</span><span style="color: #BA2121">&quot;r&quot;</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">&quot;r&quot;</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">&quot;text&quot;</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">&quot;1.2&quot;</span><span style="color: #008000; font-weight: bold">&gt;</span>
  <span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">submit</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">equals</span><span style="color: #008000; font-weight: bold">&gt;</span>

0.932039085967

<span style="color: #008000; font-weight: bold">&lt;/form&gt;</span>
</pre></div>
<p>

The <code>index</code> function needs adjustments since we use the same
template for the input and the output page:

<p>


<!-- code typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic"># View</span>
<span style="color: #AA22FF">@app.route</span>(<span style="color: #BA2121">&#39;/hw2&#39;</span>, methods<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;GET&#39;</span>, <span style="color: #BA2121">&#39;POST&#39;</span>])
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">index</span>():
    form <span style="color: #666666">=</span> InputForm(request<span style="color: #666666">.</span>form)
    <span style="color: #008000; font-weight: bold">if</span> request<span style="color: #666666">.</span>method <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;POST&#39;</span> <span style="color: #AA22FF; font-weight: bold">and</span> form<span style="color: #666666">.</span>validate():
        r <span style="color: #666666">=</span> form<span style="color: #666666">.</span>r<span style="color: #666666">.</span>data
        s <span style="color: #666666">=</span> compute(r)
    <span style="color: #008000; font-weight: bold">else</span>:
        s <span style="color: #666666">=</span> <span style="color: #008000">None</span>

    <span style="color: #008000; font-weight: bold">return</span> render_template(<span style="color: #BA2121">&quot;view.html&quot;</span>, form<span style="color: #666666">=</span>form, s<span style="color: #666666">=</span>s)
</pre></div>
<p>
It is seen that if the user has given data, <code>s</code> is a <code>float</code>, otherwise
<code>s</code> is <code>None</code>. You are encouraged to test the app by running

<p>


<!-- code typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python controller.py
</pre></div>
<p>
and loading <code>http://127.0.0.1:5000/hw2</code> into your browser.
A nice little exercise is to control the formatting of the result <code>s</code>.
To this end, you transform <code>s</code> to a string: <code>s = '%.5f' % s</code> before
sending it to <code>render_template</code>.

<p>
<p>
<!-- ------------------- end of main content --------------- -->


<!--
Preliminary examples/discussion on vagrant style syntax

<div class='alert alert-block alert-notice'>
  <h3>What about PHP? Python? Java?</h3>
<p>
bla-bla.
</div>

<p>
While the <div class="deep-blue">rest of the</div> getting started
-->

<ul class="pager">
  <li class="previous">
    <a href="._part0003_web4sa_flask.html">&larr; Prev</a>
  </li>

  <li class="next">
    <a href="._part0005_web4sa_flask.html">Next &rarr;</a>
  </li>

</ul>

 </div>

<!-- ------------------- end of main content --------------- -->

 <div class="row Footer">
  <div class="span12">
  Copyright &copy 2013; Hans Petter Langtangen and Anders E. Johansen.
  Last update: .
  </div>
 </div>
</div>
</body>
</html>



